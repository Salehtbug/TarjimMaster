@model Tarjim.ViewModels.AdminDashboardViewModel
@{
    ViewData["Title"] = "لوحة تحكم الإدارة";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="admin-dashboard">
    <!-- ملخص الإحصائيات -->
    <div class="stats-summary">
        <div class="row">
            <div class="col-md-3">
                <div class="stat-card bg-primary text-white">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">@Model.TotalUsers</h3>
                        <p class="stat-label">إجمالي المستخدمين</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-success text-white">
                    <div class="stat-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">@Model.TotalProjects</h3>
                        <p class="stat-label">إجمالي المشاريع</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-info text-white">
                    <div class="stat-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">@Model.TotalRevenue.ToString("0.00") JOD</h3>
                        <p class="stat-label">إجمالي الإيرادات</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-warning text-white">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">@Model.PlatformProfit.ToString("0.00") JOD</h3>
                        <p class="stat-label">أرباح المنصة</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <!-- إحصائيات المشاريع -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">إحصائيات المشاريع</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="mini-stat">
                                <div class="mini-stat-icon bg-light-primary">
                                    <i class="fas fa-folder-open text-primary"></i>
                                </div>
                                <div class="mini-stat-info">
                                    <span class="mini-stat-value">@Model.OpenProjects</span>
                                    <p class="mini-stat-label">مشاريع مفتوحة</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="mini-stat">
                                <div class="mini-stat-icon bg-light-info">
                                    <i class="fas fa-spinner text-info"></i>
                                </div>
                                <div class="mini-stat-info">
                                    <span class="mini-stat-value">@Model.InProgressProjects</span>
                                    <p class="mini-stat-label">قيد التنفيذ</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 mt-3">
                            <div class="mini-stat">
                                <div class="mini-stat-icon bg-light-success">
                                    <i class="fas fa-check-circle text-success"></i>
                                </div>
                                <div class="mini-stat-info">
                                    <span class="mini-stat-value">@Model.CompletedProjects</span>
                                    <p class="mini-stat-label">مكتملة</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 mt-3">
                            <div class="mini-stat">
                                <div class="mini-stat-icon bg-light-danger">
                                    <i class="fas fa-times-circle text-danger"></i>
                                </div>
                                <div class="mini-stat-info">
                                    <span class="mini-stat-value">@Model.CanceledProjects</span>
                                    <p class="mini-stat-label">ملغاة</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <a href="@Url.Action("Projects", "Admin")" class="btn btn-sm btn-primary">عرض جميع المشاريع</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- إحصائيات المستخدمين -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">إحصائيات المستخدمين</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="mini-stat">
                                <div class="mini-stat-icon bg-light-primary">
                                    <i class="fas fa-user-tie text-primary">
                                        <div class="mini-stat-icon bg-light-primary">
                                            <i class="fas fa-user-tie text-primary"></i>
                                        </div>
                                        <div class="mini-stat-info">
                                            <span class="mini-stat-value">@Model.TotalTranslators</span>
                                            <p class="mini-stat-label">مترجمين</p>
                                        </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="mini-stat">
                                    <div class="mini-stat-icon bg-light-info">
                                        <i class="fas fa-user text-info"></i>
                                    </div>
                                    <div class="mini-stat-info">
                                        <span class="mini-stat-value">@Model.TotalClients</span>
                                        <p class="mini-stat-label">عملاء</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 mt-3">
                                <div class="mini-stat">
                                    <div class="mini-stat-icon bg-light-success">
                                        <i class="fas fa-user-check text-success"></i>
                                    </div>
                                    <div class="mini-stat-info">
                                        <span class="mini-stat-value">@Model.ActiveTranslators</span>
                                        <p class="mini-stat-label">مترجمين نشطين</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 mt-3">
                                <div class="mini-stat">
                                    <div class="mini-stat-icon bg-light-warning">
                                        <i class="fas fa-star text-warning"></i>
                                    </div>
                                    <div class="mini-stat-info">
                                        <span class="mini-stat-value">@Model.AverageTranslatorRating.ToString("0.0")</span>
                                        <p class="mini-stat-label">متوسط التقييم</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <a href="@Url.Action("Users", "Admin")" class="btn btn-sm btn-primary">عرض جميع المستخدمين</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- المشاريع الحديثة -->
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">المشاريع الحديثة</h5>
                        <a href="@Url.Action("Projects", "Admin")" class="btn btn-sm btn-link">عرض الكل</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>المشروع</th>
                                        <th>العميل</th>
                                        <th>الحالة</th>
                                        <th>التاريخ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var project in Model.RecentProjects)
                                    {
                                        <tr>
                                            <td>
                                                <a href="@Url.Action("ProjectDetails", "Admin", new { id = project.ProjectId })">
                                                    @project.Title
                                                </a>
                                            </td>
                                            <td>@project.Client?.Name</td>
                                            <td>
                                                @{
                                                    string badgeClass = project.Status switch
                                                    {
                                                        "Open" => "badge bg-secondary",
                                                        "Assigned" => "badge bg-info",
                                                        "In Progress" => "badge bg-primary",
                                                        "Completed" => "badge bg-success",
                                                        "Received" => "badge bg-success",
                                                        "Canceled" => "badge bg-danger",
                                                        _ => "badge bg-secondary"
                                                    };

                                                    string statusText = project.Status switch
                                                    {
                                                        "Open" => "مفتوح",
                                                        "Assigned" => "تم التعيين",
                                                        "In Progress" => "قيد التنفيذ",
                                                        "Completed" => "مكتمل",
                                                        "Received" => "تم الاستلام",
                                                        "Canceled" => "ملغي",
                                                        _ => project.Status
                                                    };
                                                }
                                                <span class="@badgeClass">@statusText</span>
                                            </td>
                                            <td>@project.CreatedAt?.ToString("yyyy/MM/dd")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- طلبات الترجمة الفورية -->
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">طلبات الترجمة الفورية</h5>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-primary me-2">@Model.PendingInstantRequests طلبات قيد الانتظار</span>
                            <a href="@Url.Action("InstantRequests", "Admin")" class="btn btn-sm btn-link">عرض الكل</a>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>الموضوع</th>
                                        <th>العميل</th>
                                        <th>الحالة</th>
                                        <th>التاريخ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.RecentInstantRequests != null && Model.RecentInstantRequests.Any())
                                    {
                                        @foreach (var request in Model.RecentInstantRequests)
                                        {
                                            <tr>
                                                <td>
                                                    <a href="@Url.Action("InstantRequestDetails", "Admin", new { id = request.RequestId })">
                                                        @request.Subject
                                                    </a>
                                                </td>
                                                <td>@request.ClientName</td>
                                                <td>
                                                    @{
                                                        string badgeClass = request.Status switch
                                                        {
                                                            "Pending" => "badge bg-warning",
                                                            "Approved" => "badge bg-success",
                                                            "Completed" => "badge bg-info",
                                                            "Canceled" => "badge bg-danger",
                                                            _ => "badge bg-secondary"
                                                        };

                                                        string statusText = request.Status switch
                                                        {
                                                            "Pending" => "قيد الانتظار",
                                                            "Approved" => "تمت الموافقة",
                                                            "Completed" => "مكتمل",
                                                            "Canceled" => "ملغي",
                                                            _ => request.Status
                                                        };
                                                    }
                                                    <span class="@badgeClass">@statusText</span>
                                                </td>
                                                <td>@request.CreatedAt.ToString("yyyy/MM/dd")</td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="4" class="text-center py-3">لا توجد طلبات ترجمة فورية</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- أفضل المترجمين -->
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">أفضل المترجمين</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>المترجم</th>
                                        <th>التقييم</th>
                                        <th>المشاريع</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.TopTranslators != null && Model.TopTranslators.Any())
                                    {
                                        @foreach (var translator in Model.TopTranslators)
                                        {
                                            <tr>
                                                <td>
                                                    <a href="@Url.Action("UserDetails", "Admin", new { id = translator.UserId })">
                                                        <div class="d-flex align-items-center">
                                                            @if (!string.IsNullOrEmpty(translator.AvatarUrl))
                                                            {
                                                                <img src="@translator.AvatarUrl" class="avatar-sm me-2 rounded-circle" alt="@translator.Name">
                                                            }
                                                            else
                                                            {
                                                                <div class="avatar-sm me-2 rounded-circle bg-primary text-white d-flex align-items-center justify-content-center">
                                                                    @translator.Name[0]
                                                                </div>
                                                            }
                                                            <span>@translator.Name</span>
                                                        </div>
                                                    </a>
                                                </td>
                                                <td>
                                                    <div class="rating-stars">
                                                        @{
                                                            var rating = translator.Rating ?? 0;
                                                            // for (int i = 1; i <= 5; i++)
                                                            // {
                                                            //     if (i <= rating)
                                                            //     {
                                                            //         <i class="fas fa-star text-warning"></i>
                                                            //     }
                                                            //     else if (i - 0.5 <= rating)
                                                            //     {
                                                            //         <i class="fas fa-star-half-alt text-warning"></i>
                                                            //     }
                                                            //     else
                                                            //     {
                                                            //         <i class="far fa-star text-warning"></i>
                                                            //     }
                                                            // }
                                                        }
                                                        <span class="ms-1">(@rating.ToString("0.0"))</span>
                                                    </div>
                                                </td>
                                                <td>@translator.ProjectAssignedTranslators.Count</td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="3" class="text-center py-3">لا توجد بيانات متاحة</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- أفضل فئات الترجمة -->
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">أفضل فئات الترجمة</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>الفئة</th>
                                        <th>عدد المشاريع</th>
                                        <th>الإيرادات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.TopCategories != null && Model.TopCategories.Any())
                                    {
                                        @foreach (var category in Model.TopCategories)
                                        {
                                            <tr>
                                                <td>@category.CategoryName</td>
                                                <td>@category.ProjectCount</td>
                                                <td>@category.TotalRevenue.ToString("0.00") JOD</td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="3" class="text-center py-3">لا توجد بيانات متاحة</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- النشاط الحديث -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">النشاط الحديث</h5>
                        <a href="@Url.Action("Activity", "Admin")" class="btn btn-sm btn-link">عرض كل النشاطات</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>المستخدم</th>
                                        <th>النشاط</th>
                                        <th>الوصف</th>
                                        <th>التاريخ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.RecentActivities != null && Model.RecentActivities.Any())
                                    {
                                        @foreach (var activity in Model.RecentActivities)
                                        {
                                            <tr>
                                                <td>
                                                    @if (activity.User != null)
                                                    {
                                                        <a href="@Url.Action("UserDetails", "Admin", new { id = activity.UserId })">
                                                            @activity.User.Name
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <span>مستخدم غير معروف</span>
                                                    }
                                                </td>
                                                <td>
                                                    @{
                                                        string activityIcon = activity.ActivityType switch
                                                        {
                                                            "CreateProject" => "fa-folder-plus text-success",
                                                            "EditProject" => "fa-edit text-primary",
                                                            "DeleteProject" => "fa-trash text-danger",
                                                            "CreateOffer" => "fa-hand-holding-usd text-info",
                                                            "AcceptOffer" => "fa-check-circle text-success",
                                                            "StartWorking" => "fa-play text-primary",
                                                            "CompleteProject" => "fa-check-double text-success",
                                                            "Login" => "fa-sign-in-alt text-info",
                                                            "Logout" => "fa-sign-out-alt text-warning",
                                                            _ => "fa-circle-info text-secondary"
                                                        };
                                                    }
                                                    <i class="fas @activityIcon me-1"></i>
                                                    @activity.ActivityType
                                                </td>
                                                <td>@activity.Description</td>
                                                <td>@activity.CreatedAt?.ToString("yyyy/MM/dd HH:mm")</td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="4" class="text-center py-3">لا توجد أنشطة حديثة</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <script>
            $(document).ready(function() {
                // يمكن إضافة أي سكريبتات ضرورية للوحة التحكم هنا
            });
        </script>
    }
